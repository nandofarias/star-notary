<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Notary</title>
    <link rel="stylesheet" type="text/css" href="style.css">

    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
</head>

<body>
    <div class="container">
        <h1>Create Star</h1>

        <div class="row">
            <label for="star-name" class="bold">Star Name:</label>
            <input id="star-name" />
        </div>

        <div class="row">
            <label for="star-story" class="bold">Star Story:</label>
            <input id="star-story" />
        </div>

        <div class="row">
            <label for="star-ra" class="bold">Star Ra:</label>
            <input id="star-ra" />
        </div>

        <div class="row">
            <label for="star-dec" class="bold">Star Dec:</label>
            <input id="star-dec" />
        </div>

        <div class="row">
            <label for="star-mag" class="bold">Star Mag:</label>
            <input id="star-mag" />
        </div>

        <button id="claim-button" onclick="claimButtonClicked()">Claim Star</button>
    </div>

    <div class="container">
        <h1>Look Up Star By Id</h1>

        <div class="row">
            <label for="star-id-to-find" class="bold">Star Id:</label>
            <input id="star-id-to-find" />
        </div>

        <div class="row">
            <label for="star-name-received" class="bold">Star Name:</label>
            <input id="star-name-received" disabled />
        </div>

        <div class="row">
            <label for="star-story-received" class=" bold">Star Story:</label>
            <input id="star-story-received" disabled />
        </div>

        <div class="row">
            <label for="star-ra-received" class="bold">Star Ra:</label>
            <input id="star-ra-received" disabled />
        </div>

        <div class="row">
            <label for="star-dec-received" class="bold">Star Dec:</label>
            <input id="star-dec-received" disabled />
        </div>

        <div class="row">
            <label for="star-mag-received" class="bold">Star Mag:</label>
            <input id="star-mag-received" disabled />
        </div>

        <button id="find-star-button" onclick="findStarClicked()">Find Star</button>
    </div>

    <div class="container">
        <h1>Put Star For Sale</h1>

        <div class="row">
            <label for="star-id-for-sale" class="bold">Star Id:</label>
            <input id="star-id-for-sale" />
        </div>

        <div class="row">
            <label for="star-price-for-sale" class="bold">Star Price:</label>
            <input id="star-price-for-sale" />
        </div>

        <button id="put-for-sale-button" onclick="putStarUpForSaleClicked()">Put for sale</button>
    </div>

    <div class="container">
        <h1>Buy Star</h1>

        <div class="row">
            <label for="star-id-to-buy" class="bold">Star Id:</label>
            <input id="star-id-to-buy" />
        </div>

        <div class="row">
            <label for="star-price-to-buy" class="bold">Star Price:</label>
            <input id="star-price-to-buy" />
        </div>

        <button id="buy-star-button" onclick="buyStarClicked()">Buy Star</button>
    </div>

    <script>
        if (typeof web3 != 'undefined') {
            web3 = new Web3(web3.currentProvider) // what Metamask injected 
        } else {
            // Instantiate and set Ganache as your provider
            web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
        }

        // The default (top) wallet account from a list of test accounts 
        web3.eth.defaultAccount = web3.eth.accounts[0];

        // The interface definition for your smart contract (the ABI) 
        var StarNotary = web3.eth.contract(
            [{
                    "constant": true,
                    "inputs": [{
                        "name": "interfaceId",
                        "type": "bytes4"
                    }],
                    "name": "supportsInterface",
                    "outputs": [{
                        "name": "",
                        "type": "bool"
                    }],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [{
                        "name": "",
                        "type": "uint256"
                    }],
                    "name": "starsForSale",
                    "outputs": [{
                        "name": "",
                        "type": "uint256"
                    }],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [{
                        "name": "tokenId",
                        "type": "uint256"
                    }],
                    "name": "getApproved",
                    "outputs": [{
                        "name": "",
                        "type": "address"
                    }],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [{
                            "name": "to",
                            "type": "address"
                        },
                        {
                            "name": "tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "approve",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [{
                        "name": "",
                        "type": "uint256"
                    }],
                    "name": "tokenIdToStarInfo",
                    "outputs": [{
                            "name": "name",
                            "type": "string"
                        },
                        {
                            "name": "starStory",
                            "type": "string"
                        },
                        {
                            "name": "ra",
                            "type": "string"
                        },
                        {
                            "name": "dec",
                            "type": "string"
                        },
                        {
                            "name": "mag",
                            "type": "string"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [{
                            "name": "from",
                            "type": "address"
                        },
                        {
                            "name": "to",
                            "type": "address"
                        },
                        {
                            "name": "tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "transferFrom",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [{
                        "name": "",
                        "type": "bytes32"
                    }],
                    "name": "checkIfStarExist",
                    "outputs": [{
                        "name": "",
                        "type": "bool"
                    }],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [{
                            "name": "from",
                            "type": "address"
                        },
                        {
                            "name": "to",
                            "type": "address"
                        },
                        {
                            "name": "tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "safeTransferFrom",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [{
                        "name": "tokenId",
                        "type": "uint256"
                    }],
                    "name": "ownerOf",
                    "outputs": [{
                        "name": "",
                        "type": "address"
                    }],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [{
                        "name": "owner",
                        "type": "address"
                    }],
                    "name": "balanceOf",
                    "outputs": [{
                        "name": "",
                        "type": "uint256"
                    }],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [{
                            "name": "to",
                            "type": "address"
                        },
                        {
                            "name": "approved",
                            "type": "bool"
                        }
                    ],
                    "name": "setApprovalForAll",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [{
                            "name": "from",
                            "type": "address"
                        },
                        {
                            "name": "to",
                            "type": "address"
                        },
                        {
                            "name": "tokenId",
                            "type": "uint256"
                        },
                        {
                            "name": "_data",
                            "type": "bytes"
                        }
                    ],
                    "name": "safeTransferFrom",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [{
                            "name": "owner",
                            "type": "address"
                        },
                        {
                            "name": "operator",
                            "type": "address"
                        }
                    ],
                    "name": "isApprovedForAll",
                    "outputs": [{
                        "name": "",
                        "type": "bool"
                    }],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "anonymous": false,
                    "inputs": [{
                            "indexed": true,
                            "name": "from",
                            "type": "address"
                        },
                        {
                            "indexed": true,
                            "name": "to",
                            "type": "address"
                        },
                        {
                            "indexed": true,
                            "name": "tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "Transfer",
                    "type": "event"
                },
                {
                    "anonymous": false,
                    "inputs": [{
                            "indexed": true,
                            "name": "owner",
                            "type": "address"
                        },
                        {
                            "indexed": true,
                            "name": "approved",
                            "type": "address"
                        },
                        {
                            "indexed": true,
                            "name": "tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "Approval",
                    "type": "event"
                },
                {
                    "anonymous": false,
                    "inputs": [{
                            "indexed": true,
                            "name": "owner",
                            "type": "address"
                        },
                        {
                            "indexed": true,
                            "name": "operator",
                            "type": "address"
                        },
                        {
                            "indexed": false,
                            "name": "approved",
                            "type": "bool"
                        }
                    ],
                    "name": "ApprovalForAll",
                    "type": "event"
                },
                {
                    "constant": false,
                    "inputs": [{
                            "name": "_name",
                            "type": "string"
                        },
                        {
                            "name": "_starStory",
                            "type": "string"
                        },
                        {
                            "name": "_ra",
                            "type": "string"
                        },
                        {
                            "name": "_dec",
                            "type": "string"
                        },
                        {
                            "name": "_mag",
                            "type": "string"
                        },
                        {
                            "name": "_tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "createStar",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [{
                            "name": "_tokenId",
                            "type": "uint256"
                        },
                        {
                            "name": "_price",
                            "type": "uint256"
                        }
                    ],
                    "name": "putStarUpForSale",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [{
                        "name": "_tokenId",
                        "type": "uint256"
                    }],
                    "name": "buyStar",
                    "outputs": [],
                    "payable": true,
                    "stateMutability": "payable",
                    "type": "function"
                }
            ]
        );
        // Grab the contract at specified deployed address with the interface defined by the ABI
        var starNotary = StarNotary.at('0x666637902600847d30f091e59e1cdc2c116a0df0');

        // Enable claim button being clicked
        var starId = 1;

        function claimButtonClicked() {
            web3.eth.getAccounts(function (error, accounts) {
                if (error) {
                    console.log(error)
                    return
                }
                var account = accounts[0]
                var starName = document.getElementById('star-name').value;
                var starStory = document.getElementById('star-story').value;
                var starRa = document.getElementById('star-ra').value;
                var starDec = document.getElementById('star-dec').value;
                var starMag = document.getElementById('star-mag').value;
                starNotary.createStar(starName, starStory, starRa, starDec, starMag, starId++, {
                        from: account
                    },

                    function (
                        error,
                        result) {
                        if (!error) {
                            console.log(`https://rinkeby.etherscan.io/tx/${result}`);
                        } else {
                            console.log(error);
                        }
                    });

            })
        }

        function findStarClicked() {
            var starIdToFind = document.getElementById('star-id-to-find').value;
            starNotary.tokenIdToStarInfo(starIdToFind,

                function (
                    error,
                    result) {
                    if (!error) {
                        document.getElementById('star-name-received').value = result[0];
                        document.getElementById('star-story-received').value = result[1];
                        document.getElementById('star-ra-received').value = result[2];
                        document.getElementById('star-dec-received').value = result[3];
                        document.getElementById('star-mag-received').value = result[4];
                    } else {
                        console.log(error);
                    }
                });
        }

        function putStarUpForSaleClicked() {
            web3.eth.getAccounts(function (error, accounts) {
                if (error) {
                    console.log(error)
                    return
                }
                var account = accounts[0]
                var starIdForSale = document.getElementById('star-id-for-sale').value;
                var starPriceForSaleString = document.getElementById('star-price-for-sale').value;
                var starPriceForSale = web3.toWei(Number(starPriceForSaleString), 'ether');
                starNotary.putStarUpForSale(starIdForSale, starPriceForSale, {
                        from: account
                    },

                    function (
                        error,
                        result) {
                        if (!error) {
                            console.log(`https://rinkeby.etherscan.io/tx/${result}`);
                        } else {
                            console.log(error);
                        }
                    });

            })
        }

        function buyStarClicked() {
            web3.eth.getAccounts(function (error, accounts) {
                if (error) {
                    console.log(error)
                    return
                }
                var account = accounts[0]
                var starIdToBuy = document.getElementById('star-id-to-buy').value;
                var starPriceToBuyString = document.getElementById('star-price-to-buy').value;
                var starPriceToBuy = web3.toWei(Number(starPriceToBuyString), 'ether');
                starNotary.buyStar(starIdToBuy, {
                        from: account,
                        value: starPriceToBuy
                    },

                    function (
                        error,
                        result) {
                        if (!error) {
                            console.log(`https://rinkeby.etherscan.io/tx/${result}`);
                        } else {
                            console.log(error);
                        }
                    });

            })
        }
    </script>
</body>

</html>